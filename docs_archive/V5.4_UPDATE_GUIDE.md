# 🚀 Upbit AutoProfit Bot v5.4 - 초단타 강화 + 고정 화면

## 📋 v5.4 주요 변경사항

### 1️⃣ 스캔 주기 재조정

| 주기 | Before (v5.3) | After (v5.4) | 목적 |
|-----|---------------|--------------|------|
| **초단타 감지** | 10초 | **5초** | 더 빠른 급등/급락 포착 |
| **포지션 체크** | 5초 | **3초** | 실시간 매수/매도 결정 |
| **전체 스캔** | 3분 (즉시 진입) | **1분 (분석 후 대기)** | 진입 전 신중한 분석 |
| **코인 갱신** | 5분 | **3분** | 더 자주 최적 코인 갱신 |

---

### 2️⃣ 초단타 포지션 변경

```
Before: 최대 2개
After:  기본 3개, 최대 5개

운영 방식:
- 일반적으로 3개 슬롯 사용
- 확신도 80% 이상일 때만 4~5개 확장
```

**확신도 계산:**
```python
확신도 = (
    RSI 극단값 점수 (30점) +
    거래량 폭증 점수 (30점) +
    가격 급등/급락 점수 (20점) +
    시장 모멘텀 점수 (20점)
) / 100

80% 이상: 4~5개 슬롯 허용
80% 미만: 3개 슬롯만 사용
```

---

### 3️⃣ 일반 포지션 최대 5개

```
전체 포지션 = 초단타 (3~5개) + 일반 (최대 5개)

하지만 동시에:
- 초단타 3개 + 일반 5개 = 총 8개 (X)
- 전체 최대 5개 슬롯 공유

실제 운영:
- 초단타 우선: 급등/급락 감지 시 먼저 진입
- 일반 매수: 빈 슬롯 있을 때만 진입
```

---

### 4️⃣ 고정 화면 시스템

#### 화면 레이아웃
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        Upbit AutoProfit Bot v5.4        | 2026-02-11 21:49:30
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[ 매수 포지션 ]
1️⃣ KRW-BTC    | 50,000,000원 | 📈 +1.2% | 보유  45초 | ⚡초
2️⃣ KRW-ETH    |  3,000,000원 | 📉 -0.5% | 보유 120초 | 🔥공
3️⃣ (빈 슬롯)
4️⃣ (빈 슬롯)
5️⃣ (빈 슬롯)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[ 매도 결과 ]
💰 1️⃣ KRW-BTC 매도 완료: +600,000원 (+1.2%) | 보유: 45초
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 스캔 | 코인 20개 스캔 완료 | 21:49:35
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🤖 상태 | 정상 가동 중 (초단타 2/3, 일반 0/5)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 특징
```
✅ 한 화면 고정: 스크롤 없음
✅ 포지션 슬롯: 1~5번 고정 위치
✅ 매도 결과: 5초간 표시 후 자동 사라짐
✅ 스캔 상태: 한 줄로 요약
✅ 실시간 업데이트: 3초마다 자동 갱신
```

#### 전략 표시 (이모지)
| 전략 | 표시 | 설명 |
|-----|------|------|
| ultra_scalping | ⚡초 | 초단타 |
| aggressive_scalping | 🔥공 | 공격형 |
| conservative_scalping | 🛡️보 | 보수형 |
| mean_reversion | ↩️평 | 평균회귀 |
| grid_trading | 📊그 | 그리드 |

---

## 🔄 새로운 실행 흐름

### 5초 주기: 초단타 급등/급락 감지
```python
while True:
    if time.time() - last_surge_scan >= 5:
        # 배치 API로 전체 코인 현재가 조회
        prices = get_current_prices(tickers)
        
        # 급등/급락 감지
        for ticker, price in prices.items():
            surge = detect_surge(ticker, price)
            if surge:
                confidence = calculate_confidence(surge)
                
                # 확신도에 따라 슬롯 수 결정
                if confidence >= 0.8:
                    max_slots = 5  # 확신 있을 때
                else:
                    max_slots = 3  # 일반적으로
                
                if len(ultra_positions) < max_slots:
                    # 빈 슬롯 찾기
                    slot = display.get_available_slot()
                    if slot:
                        execute_ultra_buy(ticker, slot)
```

---

### 3초 주기: 포지션 체크
```python
while True:
    if time.time() - last_position_check >= 3:
        # 모든 포지션 업데이트
        for slot, position in positions.items():
            current_price = get_current_price(position.ticker)
            
            # 화면 업데이트
            display.update_position(
                slot=slot,
                ticker=position.ticker,
                entry_price=position.entry_price,
                current_price=current_price,
                ...
            )
            
            # 매수/매도 결정
            should_exit = check_exit_conditions(position, current_price)
            if should_exit:
                execute_sell(position, slot)
```

---

### 1분 주기: 전체 스캔 + 분석
```python
while True:
    if time.time() - last_full_scan >= 60:
        # 전체 코인 스캔
        for ticker in tickers:
            # 기술적 분석
            indicators = analyze_ticker(ticker)
            
            # 진입 신호 체크
            signal = strategy.generate_signal(indicators)
            
            if signal == "BUY":
                # 즉시 진입하지 않고 대기 리스트에 추가
                add_to_watch_list(ticker, signal, indicators)
        
        # 대기 리스트에서 최적 코인 선택
        best_ticker = select_best_from_watch_list()
        
        # 빈 슬롯 있으면 진입
        if best_ticker and display.is_slot_available():
            slot = display.get_available_slot()
            execute_buy(best_ticker, slot)
```

---

### 3분 주기: 동적 코인 갱신
```python
while True:
    if time.time() - last_coin_update >= 180:
        # 코인 목록 재선정
        new_tickers = dynamic_selector.get_coins(method="volume")
        
        # 화면 상태 업데이트
        display.update_scan_status(
            f"코인 갱신 완료: {len(new_tickers)}개"
        )
```

---

## 📊 예상 성과 (v5.4)

### 거래 빈도
| 시간대 | 초단타 | 일반 매수 | 합계 |
|--------|--------|----------|------|
| **1시간** | 5~8건 | 3~5건 | 8~13건 |
| **3시간** | 15~24건 | 9~15건 | 24~39건 |
| **하루** | 50~80건 | 30~50건 | 80~130건 |

### 수익 예상 (승률 60%)
| 자본금 | 일일 거래 | 일일 수익 | 월 수익 |
|--------|----------|----------|---------|
| 10만원 | 80~100건 | +4,000~6,000원 | +120,000~180,000원 |
| 20만원 | 100~120건 | +8,000~12,000원 | +240,000~360,000원 |
| 30만원 | 120~150건 | +12,000~18,000원 | +360,000~540,000원 |

---

## ⚙️ 설정 파일 (.env)

```env
# ===== v5.4 업데이트 설정 =====

# 초단타 설정
ULTRA_DEFAULT_POSITIONS=3       # 기본 3개
ULTRA_MAX_POSITIONS=5          # 최대 5개
ULTRA_SCAN_INTERVAL=5          # 5초마다 스캔
HIGH_CONFIDENCE_THRESHOLD=0.8   # 80% 이상 확신 시 5개

# 포지션 체크
POSITION_CHECK_INTERVAL=3       # 3초마다 체크

# 전체 스캔
FULL_SCAN_INTERVAL=60          # 1분마다 스캔
ENABLE_AUTO_ENTRY=false        # 자동 진입 비활성화 (분석 후 대기)

# 코인 갱신
COIN_UPDATE_INTERVAL=180        # 3분마다 갱신
MAX_GENERAL_POSITIONS=5         # 일반 매수 최대 5개
```

---

## 🎯 사용 방법

### 1단계: 설정 업데이트
```bash
# 최신 코드 다운로드
git pull origin main

# 또는 GitHub에서 재다운로드
https://github.com/lee-jungkil/Lj
```

### 2단계: 환경 검증
```bash
verify_setup.bat
```

### 3단계: 실행
```bash
run_paper.bat        # 모의투자
run_live.bat         # 실거래
```

### 4단계: 화면 확인
```
✅ 포지션 영역 고정
✅ 매도 결과 5초간 표시
✅ 스캔 상태 실시간 업데이트
✅ 스크롤 없이 한 화면에서 모니터링
```

---

## 📈 v5.3 → v5.4 비교

| 항목 | v5.3 | v5.4 |
|-----|------|------|
| **초단타 스캔** | 10초 | 5초 (2배 빠름) |
| **포지션 체크** | 5초 | 3초 (1.6배 빠름) |
| **전체 스캔** | 3분 (즉시 진입) | 1분 (분석 후 대기) |
| **코인 갱신** | 5분 | 3분 (1.6배 빠름) |
| **초단타 슬롯** | 최대 2개 | 기본 3개, 최대 5개 |
| **일반 슬롯** | 무제한 | 최대 5개 |
| **화면 표시** | 스크롤 | 고정 화면 (개선!) |
| **진입 빈도** | 시간당 8~15건 | 시간당 10~20건 |

---

## ✅ 체크리스트

**업데이트 후 확인:**
- [ ] 5초마다 초단타 스캔
- [ ] 3초마다 포지션 체크
- [ ] 1분마다 전체 스캔
- [ ] 3분마다 코인 갱신
- [ ] 포지션 1~5번 슬롯 고정 표시
- [ ] 매도 결과 5초간 표시 후 사라짐
- [ ] 한 화면에서 스크롤 없이 모니터링

---

## 📞 문제 해결

| 문제 | 해결 |
|-----|------|
| 화면이 깨짐 | Windows 터미널 UTF-8 인코딩 확인 |
| 색상 안 나옴 | colorama 설치: `pip install colorama` |
| 포지션 안 보임 | display.render() 주기 확인 |

---

**GitHub:** https://github.com/lee-jungkil/Lj  
**버전:** v5.4  
**날짜:** 2026-02-11  
**변경:** 초단타 강화 + 고정 화면

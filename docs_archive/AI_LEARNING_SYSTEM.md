# 🎓 AI 학습 시스템 가이드

> **AutoProfit Bot의 핵심 혁신**: 모든 거래 경험을 학습하여 자동으로 성장하는 AI 트레이딩 시스템

---

## 📚 목차

1. [시스템 개요](#시스템-개요)
2. [주요 기능](#주요-기능)
3. [학습 프로세스](#학습-프로세스)
4. [AI 의사결정](#ai-의사결정)
5. [실행 방법](#실행-방법)
6. [성과 모니터링](#성과-모니터링)
7. [고급 설정](#고급-설정)

---

## 🎯 시스템 개요

### 핵심 컨셉

**"모든 경험이 축적되어 전략이 진화합니다"**

- 📊 **경험 축적**: 매 거래마다 시장 상황, 결과, 패턴 자동 기록
- 🧠 **패턴 학습**: 성공/실패 경험을 분석하여 최적 패턴 발견
- ⚙️ **자동 최적화**: 학습 결과를 바탕으로 전략 파라미터 자동 조정
- 🔮 **예측 강화**: 과거 유사 상황 분석으로 미래 의사결정 개선

### 시스템 구조

```
┌─────────────────────────────────────┐
│      매수/매도 실행                 │
│  (거래 실행 + 경험 기록)            │
└──────────┬──────────────────────────┘
           │
           ▼
┌─────────────────────────────────────┐
│    📚 경험 데이터베이스              │
│  - 거래 이력                         │
│  - 시장 상황 스냅샷                  │
│  - 수익/손실 결과                    │
└──────────┬──────────────────────────┘
           │
           ▼
┌─────────────────────────────────────┐
│    🧠 AI 학습 엔진                   │
│  - 유사 상황 패턴 분석               │
│  - 성공률 계산                       │
│  - 최적 파라미터 도출                │
└──────────┬──────────────────────────┘
           │
           ▼
┌─────────────────────────────────────┐
│    🎯 의사결정 강화                  │
│  - 매수 신뢰도 분석                  │
│  - 매도 타이밍 예측                  │
│  - 전략 파라미터 자동 조정           │
└─────────────────────────────────────┘
```

---

## 🌟 주요 기능

### 1. 📊 다차원 시장 분석

**14가지 지표 종합 분석**

```python
시장 스냅샷 구성요소:
├─ 가격 정보
│  ├─ price              # 현재가
│  ├─ price_change_1m    # 1분 가격 변화
│  ├─ price_change_5m    # 5분 가격 변화
│  └─ price_change_15m   # 15분 가격 변화
│
├─ 기술적 지표
│  ├─ rsi                # RSI (과매도/과매수)
│  ├─ macd               # MACD
│  ├─ macd_signal        # MACD 시그널
│  └─ bb_position        # 볼린저 밴드 내 위치
│
├─ 거래량
│  ├─ volume_ratio       # 평균 대비 거래량
│  └─ volume_spike       # 거래량 급증 여부
│
├─ 추세
│  ├─ trend              # 추세 방향 (up/down/sideways)
│  └─ trend_strength     # 추세 강도 (0~1)
│
├─ 변동성
│  └─ volatility         # 변동성 지표
│
└─ 시장 상태
   └─ market_phase       # 시장 국면 (bullish/bearish/neutral)
```

### 2. 🧠 AI 의사결정 시스템

#### A. 매수 판단 분석

**과거 유사 상황 분석**

```
┌─ 현재 상황 입력 ─────────────────────────┐
│  RSI: 28, 거래량: 2.3x, 추세: 하락       │
└────────────┬─────────────────────────────┘
             │
             ▼
┌─ AI 분석 ──────────────────────────────┐
│  유사 상황 20건 검색                     │
│  ├─ 성공 거래: 15건 (75%)               │
│  ├─ 실패 거래: 5건 (25%)                │
│  └─ 평균 수익률: +1.8%                  │
└────────────┬───────────────────────────┘
             │
             ▼
┌─ 결론 ─────────────────────────────────┐
│  ✅ STRONG_BUY                          │
│  신뢰도: 75%                             │
│  사유: 유사 상황 성공률 75% (평균 +1.8%)│
└─────────────────────────────────────────┘
```

**의사결정 카테고리**

| 결정 | 조건 | 신뢰도 | 의미 |
|------|------|--------|------|
| **STRONG_BUY** | 성공률 ≥ 65% AND 평균수익 > 0 | 높음 | 강력 매수 권장 |
| **BUY** | 성공률 ≥ 65% | 중간 | 매수 권장 |
| **NEUTRAL** | 35% < 성공률 < 65% | 낮음 | 불확실, 기본 전략 |
| **AVOID** | 성공률 ≤ 35% | 높음 | 매수 회피 권장 |

#### B. 매도 판단 분석

**3가지 비교 분석**

```
1️⃣ 조기 청산 vs 더 보유
   ├─ 과거 조기 청산 평균: +0.8%
   └─ 현재 수익: +1.2%
   → 결론: 더 보유 권장

2️⃣ 추세 반전 감지
   ├─ 현재: 수익 +1.5%, 하락 추세 시작
   ├─ 과거 유사 상황: 평균 최종 수익 +1.1%
   └─ 결론: 즉시 청산 권장

3️⃣ 보유 시간 기반
   ├─ 현재 보유: 3분
   ├─ 과거 평균 최적 청산: 5분
   └─ 결론: 보유 유지
```

### 3. ⚙️ 자동 파라미터 최적화

**학습 기반 파라미터 조정**

```python
기본 설정 (aggressive_scalping):
├─ stop_loss: 2.0%
├─ take_profit: 1.5%
└─ rsi_oversold: 30

     ↓ (20회 이상 거래 경험 축적)

AI 학습 결과:
├─ 평균 성공 손실: -0.8%  → 최적 손절: 0.8% × 0.8 = 0.64%
├─ 평균 성공 수익: +1.8%  → 최적 익절: 1.8% × 1.1 = 1.98%
└─ 성공 RSI 범위: 25~35  → 최적 RSI: 25~35

최적화 파라미터 (자동 적용):
├─ stop_loss: 0.64%     ✅ 손절 기준 강화
├─ take_profit: 1.98%   ✅ 익절 목표 상향
└─ rsi_oversold: 25     ✅ 진입 조건 정밀화

신뢰도: 82% (16/20 성공)
```

---

## 🔄 학습 프로세스

### 단계별 학습 흐름

```
1️⃣ 매수 시 (경험 기록 시작)
   ├─ 진입 시간 기록
   ├─ 진입 가격 & 수량
   ├─ 시장 상황 스냅샷 (14개 지표)
   └─ 전략 이름
         ↓
         
2️⃣ 보유 중 (상황 추적)
   ├─ 실시간 수익률 모니터링
   ├─ 시장 상황 변화 감지
   └─ AI 청산 판단 지원
         ↓
         
3️⃣ 매도 시 (경험 완성)
   ├─ 청산 가격 & 시간
   ├─ 최종 손익 & 손익률
   ├─ 보유 기간 (초)
   └─ 청산 시점 시장 상황
         ↓
         
4️⃣ 학습 실행 (경험 분석)
   ├─ 성공/실패 여부 판정
   ├─ 전략별 통계 업데이트
   ├─ 패턴 분석 & 저장
   └─ 최적 파라미터 계산
         ↓
         
5️⃣ 적용 (다음 거래 반영)
   ├─ 최적화 파라미터 자동 적용
   ├─ AI 의사결정 강화
   └─ 전략 성능 개선
```

### 데이터 저장 구조

```
trading_logs/learning/
├─ experiences.json           # 거래 경험 데이터베이스
│  └─ 최대 10,000건 저장
│
├─ strategy_stats.json        # 전략별 통계
│  ├─ 총 거래 수
│  ├─ 승률
│  ├─ 평균 수익률
│  └─ 평균 보유 시간
│
└─ optimized_params.json      # 최적화된 파라미터
   ├─ 전략별 최적 설정
   ├─ 신뢰도
   └─ 마지막 업데이트 시간
```

---

## 🎯 AI 의사결정

### 매수 의사결정 예시

```python
# 현재 상황
ticker = "KRW-BTC"
rsi = 28.5
volume_ratio = 2.3
trend = "down"

# AI 분석 실행
decision, confidence, reason = learning_engine.analyze_market_decision(
    ticker=ticker,
    df=df,  # OHLCV 데이터
    strategy='AggressiveScalping',
    current_indicators={
        'rsi': 28.5,
        'volume_ratio': 2.3,
        'trend': 'down',
        ...
    }
)

# 결과
print(f"결정: {decision}")          # STRONG_BUY
print(f"신뢰도: {confidence*100}%") # 75%
print(f"사유: {reason}")             # 유사 상황 성공률 75% (평균 +1.8%)
```

### 매도 의사결정 예시

```python
# 현재 포지션 정보
entry_price = 50_000_000
current_price = 50_700_000  # +1.4% 수익
holding_duration = 180  # 3분 보유

# AI 분석 실행
should_exit, reason, confidence = learning_engine.should_exit_position(
    ticker=ticker,
    strategy='AggressiveScalping',
    entry_price=entry_price,
    current_price=current_price,
    holding_duration=holding_duration,
    market_snapshot=market_snapshot  # 현재 시장 상황
)

# 결과
if should_exit and confidence >= 0.75:
    print(f"🧠 AI 청산 권고: {reason}")
    # 예: "추세 반전 감지, 과거 평균 0.9% → 현재 청산 유리"
```

---

## 🚀 실행 방법

### 1. 초기 실행

```bash
# 저장소 클론 (처음 실행 시)
git clone https://github.com/lee-jungkil/Lj.git
cd Lj

# 봇 실행
./run.sh

# 모드 선택
선택: 3  # Live 모드
```

### 2. AI 학습 시스템 활성화 확인

```
실행 로그 예시:

🚀 AutoProfit Bot 시작 (모드: live, 방식: 하이브리드+초단타+AI학습)
🧠 AI 학습 엔진 초기화
   저장된 경험: 0개
   학습된 전략: 0개
🎓 AI 학습 엔진 활성화 (0개 경험 로드됨)
```

### 3. 첫 거래 및 학습

```
매수 실행:
┌─────────────────────────────────────────┐
│ ✅ 매수 완료: KRW-BTC                   │
│    가격: 50,000,000원                   │
│    수량: 0.0001 BTC                     │
│    전략: AggressiveScalping             │
│    🎓 AI 학습 기록 시작                │
└─────────────────────────────────────────┘

보유 중:
┌─────────────────────────────────────────┐
│ 📊 KRW-BTC: +1.2% (60초 보유)          │
│    현재가: 50,600,000원                │
└─────────────────────────────────────────┘

매도 실행:
┌─────────────────────────────────────────┐
│ ✅ 매도 완료: KRW-BTC                   │
│    수익: +60,000원 (+1.2%)             │
│    보유: 120초                         │
│    📚 학습 완료: AggressiveScalping    │
│       수익: +1.20% | 보유: 120초       │
└─────────────────────────────────────────┘
```

### 4. 학습 진행 확인

**20회 거래 후 (자동 최적화 시작)**

```
🎓 전략 최적화 완료: AggressiveScalping
   기반 거래: 20개 (성공: 14, 실패: 6)
   신뢰도: 70.0%
   최적 손절: 0.75%
   최적 익절: 2.10%
   
🎓 AI 최적화 파라미터 적용: AggressiveScalping
   손절: 0.75% | 익절: 2.10%
```

### 5. AI 의사결정 활성화

**60회 거래 후 (충분한 경험 축적)**

```
매수 신호 분석:
┌─────────────────────────────────────────┐
│ KRW-BTC 분석 결과                       │
│                                         │
│ 기본 신호: 매수 (과매도 + 거래량 급증) │
│                                         │
│ 🧠 AI 분석:                            │
│    유사 상황: 18건                      │
│    성공률: 72.2% (13/18)               │
│    평균 수익: +1.65%                   │
│    결정: STRONG_BUY                    │
│    신뢰도: 72%                         │
│                                         │
│ ✅ 최종 결정: 강력 매수 권장           │
└─────────────────────────────────────────┘
```

---

## 📈 성과 모니터링

### 1. 전략 성과 리포트

```python
# 전략 성과 조회
report = learning_engine.get_strategy_performance_report('AggressiveScalping')

print(f"""
전략: {report['strategy']}
─────────────────────────────────────
총 거래: {report['total_trades']}회
승률: {report['success_rate']:.1f}%
평균 수익률: {report['avg_profit_ratio']:+.2f}%
총 손익: {report['total_profit_loss']:+,.0f}원
평균 보유 시간: {report['avg_holding_duration']:.0f}초

최근 30일:
  승률: {report['recent_30d_success_rate']:.1f}%
  평균 수익률: {report['recent_30d_avg_profit']:+.2f}%
  
최적화 상태: {'✅ 활성화' if report['has_optimized_params'] else '⏳ 대기 중'}
""")
```

### 2. 실시간 로그 모니터링

```bash
# 로그 파일 확인
tail -f trading_logs/trade_log.json

# 학습 데이터 확인
cat trading_logs/learning/strategy_stats.json
```

### 3. 경험 데이터베이스 조회

```bash
# 저장된 경험 수 확인
cat trading_logs/learning/experiences.json | grep "timestamp" | wc -l

# 최신 10개 경험 확인
cat trading_logs/learning/experiences.json | jq '.[-10:]'
```

---

## ⚙️ 고급 설정

### 학습 엔진 파라미터 조정

**파일: `src/ai/learning_engine.py`**

```python
class LearningEngine:
    def __init__(self, data_dir: str = "trading_logs/learning"):
        # 경험 데이터베이스
        self.max_experiences = 10000  # 최대 저장 경험 수
        
        # 학습 설정
        self.min_experiences_for_learning = 20  # 학습 최소 경험 수
        self.learning_rate = 0.1  # 파라미터 조정 비율
```

**조정 가능한 설정:**

| 파라미터 | 기본값 | 설명 | 권장 범위 |
|----------|--------|------|----------|
| `max_experiences` | 10,000 | 최대 저장 경험 수 | 5,000 ~ 50,000 |
| `min_experiences_for_learning` | 20 | 학습 시작 최소 거래 수 | 10 ~ 50 |
| `learning_rate` | 0.1 | 파라미터 조정 강도 | 0.05 ~ 0.2 |

### 유사도 임계값 조정

```python
def _find_similar_situations(self, ...):
    # 유사도 임계값
    if similarity_score >= 0.6:  # 기본값: 0.6
        similar.append(exp)
```

**임계값 조정 가이드:**

- **0.5 이하**: 더 많은 유사 상황 포함 (데이터 많음, 정확도 낮음)
- **0.6 (기본)**: 균형잡힌 설정
- **0.7 이상**: 매우 유사한 상황만 포함 (데이터 적음, 정확도 높음)

### AI 의사결정 신뢰도 조정

```python
# 매수 판단 (기본: 65%)
if success_rate >= 0.65:  # 강력 매수
    return 'STRONG_BUY', confidence, reason

# 매도 판단 (기본: 75%)
if should_exit_ai and confidence >= 0.75:  # AI 청산 권고
    return True, f"🧠 AI 청산 권고: {reason}"
```

---

## 🎓 학습 시나리오 예시

### 시나리오 1: 초기 학습 (0 → 20회 거래)

```
Day 1:
├─ 거래 1-5: 기본 전략 사용, AI 미활성화
├─ 거래 6-10: 경험 축적 중
├─ 거래 11-15: 패턴 인식 시작
└─ 거래 16-20: 기본 통계 확립

   → 결과: 승률 65%, 평균 수익 +1.2%
```

### 시나리오 2: 최적화 활성화 (20 → 50회 거래)

```
Day 2-3:
├─ 거래 21: 🎓 AI 최적화 파라미터 적용
│           손절: 2.0% → 0.8%
│           익절: 1.5% → 1.9%
│
├─ 거래 22-30: 최적화된 파라미터로 실행
│              승률 향상: 65% → 70%
│
└─ 거래 31-50: 성과 안정화
               평균 수익: +1.2% → +1.5%
```

### 시나리오 3: AI 의사결정 활성화 (50+회 거래)

```
Day 4+:
├─ 거래 51: 🧠 AI 분석 활성화
│           유사 상황 분석 시작
│
├─ 거래 55: AI 회피 권고 (성공률 30% 상황)
│           → 매수 취소 → 손실 방지
│
├─ 거래 60: AI 강력 매수 권고 (성공률 80%)
│           → 강력 매수 → 수익 +2.1%
│
└─ 거래 70+: 의사결정 정확도 상승
             승률: 70% → 75%
             평균 수익: +1.5% → +1.8%
```

---

## 📊 예상 성과

### 학습 단계별 성과 개선

| 학습 단계 | 거래 수 | 승률 | 평균 수익 | 특징 |
|-----------|---------|------|-----------|------|
| **초기** | 0~20 | 60% | +1.0% | 기본 전략 |
| **최적화 1단계** | 20~50 | 68% | +1.3% | 파라미터 조정 |
| **최적화 2단계** | 50~100 | 73% | +1.6% | AI 의사결정 |
| **성숙** | 100+ | 75%+ | +1.8%+ | 고도화 전략 |

### 월간 예상 수익 (자본 100만원 기준)

```
초기 (첫 1개월):
├─ 승률: 60%
├─ 평균 수익: +1.0%
└─ 월간 수익: 약 +60,000원 (+6%)

최적화 후 (2-3개월):
├─ 승률: 70%
├─ 평균 수익: +1.5%
└─ 월간 수익: 약 +105,000원 (+10.5%)

성숙 단계 (4개월+):
├─ 승률: 75%+
├─ 평균 수익: +1.8%+
└─ 월간 수익: 약 +135,000원 (+13.5%)+
```

---

## ⚠️ 주의사항

### 1. 학습 데이터 관리

- ✅ **정기 백업**: `trading_logs/learning/` 디렉토리 백업 권장
- ✅ **데이터 검증**: 주기적으로 `experiences.json` 무결성 확인
- ❌ **수동 편집 금지**: 학습 데이터 직접 수정 금지 (시스템 손상 위험)

### 2. 시장 변화 대응

- ⚠️ **급격한 시장 변화**: 과거 경험이 무효화될 수 있음
- 💡 **해결책**: 최근 30일 성과 중점 모니터링
- 🔄 **재학습**: 시장 상황 변화 시 경험 데이터 초기화 고려

### 3. 과최적화 방지

- ⚠️ **과적합(Overfitting)**: 과거 데이터에만 최적화 위험
- 💡 **해결책**: 최소 경험 수(20회) 유지, 신뢰도 임계값 준수
- 📊 **검증**: 실거래 전 모의투자로 검증 권장

---

## 🔗 관련 문서

- [실거래 가이드](LIVE_TRADING_GUIDE.md)
- [초단타 시스템](ULTRA_SCALPING.md)
- [빠른 시작](QUICKRUN.md)
- [README](README.md)

---

## 📞 지원

- **GitHub**: https://github.com/lee-jungkil/Lj
- **다운로드**: https://github.com/lee-jungkil/Lj/archive/refs/heads/main.zip

---

## 🎯 마무리

AI 학습 시스템은 **"경험을 통해 성장하는"** AutoProfit Bot의 핵심 혁신입니다.

### 핵심 가치

1. **자동 진화**: 수동 조정 없이 전략이 자동으로 개선
2. **경험 축적**: 모든 거래가 미래의 자산
3. **지능적 의사결정**: 과거 데이터 기반 예측
4. **지속적 성장**: 시간이 지날수록 성능 향상

### 시작하기

```bash
# 지금 바로 시작하세요!
./run.sh

# AI가 학습하며 성장하는 과정을 지켜보세요 🎓
```

**"오늘의 경험이 내일의 수익을 만듭니다"** 🚀

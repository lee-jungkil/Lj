# Fixed Screen Display - v6.14-FIXED

## ğŸ¯ í•µì‹¬ ë¬¸ì œ í•´ê²°

### ë¬¸ì œ (Before v6.14)
- **ìŠ¤í¬ë¡¤ ë°œìƒ**: í™”ë©´ì´ ê³„ì† ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤ë¨
- **ì›ì¸**: `print('\n'.join(output))` ì‚¬ìš©ìœ¼ë¡œ í„°ë¯¸ë„ ë†’ì´ë¥¼ ì´ˆê³¼í•˜ë©´ ìë™ ìŠ¤í¬ë¡¤
- **ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ë¯¸ì¶©ì¡±**: ê³ ì •ëœ í”„ë ˆì„ ì•ˆì—ì„œë§Œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•„ìš”

### í•´ê²° (v6.14-FIXED)
- **ì™„ì „ ê³ ì • í™”ë©´**: í™”ë©´ì´ ì ˆëŒ€ ìŠ¤í¬ë¡¤ë˜ì§€ ì•ŠìŒ
- **ì»¤ì„œ í¬ì§€ì…”ë‹**: ANSI ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤ë¡œ ë¼ì¸ë³„ ë®ì–´ì“°ê¸°
- **ë†’ì´ ì œí•œ ì—„ê²© ì ìš©**: í„°ë¯¸ë„ ë†’ì´ë¥¼ ì ˆëŒ€ ì´ˆê³¼í•˜ì§€ ì•ŠìŒ

---

## ğŸ”§ ê¸°ìˆ ì  êµ¬í˜„

### 1. í„°ë¯¸ë„ ë†’ì´ ê³„ì‚° ë° ì œí•œ
```python
# __init__ ë©”ì„œë“œ
terminal_size = os.get_terminal_size()
terminal_height = terminal_size.rows
self.screen_height = terminal_height - 2  # ì—¬ìœ  ê³µê°„ 2ì¤„
```

**ëª©ì **: í™”ë©´ì´ í„°ë¯¸ë„ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ìµœëŒ€ ë†’ì´ ì„¤ì •

### 2. ê³ ì • ë²„í¼ ê´€ë¦¬
```python
# render() ë©”ì„œë“œ
# ì¶œë ¥ ë¼ì¸ ìƒì„±
output_lines = [...]  # ëª¨ë“  ì»¨í…ì¸  ë¼ì¸ ìƒì„±

# â­ ë†’ì´ ì´ˆê³¼ ì‹œ ìë¥´ê¸°
if len(output_lines) > self.screen_height:
    output_lines = output_lines[:self.screen_height]

# â­ ë¶€ì¡±í•œ ê²½ìš° ë¹ˆ ì¤„ë¡œ ì±„ìš°ê¸°
while len(output_lines) < self.screen_height:
    output_lines.append(margin)
```

**ëª©ì **: í•­ìƒ ì •í™•íˆ `screen_height` ë§Œí¼ì˜ ë¼ì¸ë§Œ ì¶œë ¥

### 3. ì»¤ì„œ í¬ì§€ì…”ë‹ ì‹œìŠ¤í…œ
```python
# í™ˆ í¬ì§€ì…˜ìœ¼ë¡œ ì´ë™
sys.stdout.write('\033[H')  # ì»¤ì„œë¥¼ (1, 1)ë¡œ ì´ë™

for i, line in enumerate(output_lines, start=1):
    # í˜„ì¬ ë¼ì¸ ì§€ìš°ê¸°
    sys.stdout.write('\033[2K')
    # ë¼ì¸ ì¶œë ¥
    sys.stdout.write(line)
    # ë‹¤ìŒ ë¼ì¸ìœ¼ë¡œ ì´ë™ (ë§ˆì§€ë§‰ ë¼ì¸ ì œì™¸)
    if i < len(output_lines):
        sys.stdout.write('\n')

sys.stdout.flush()
```

**ëª©ì **: ê° ë¼ì¸ì„ ì •í™•í•œ ìœ„ì¹˜ì— ë®ì–´ì“°ê¸°, ìŠ¤í¬ë¡¤ ë°©ì§€

### 4. ì²« ë Œë”ë§ ìµœì í™”
```python
# __init__ì—ì„œ
self._first_render = True

# render()ì—ì„œ
if self._first_render:
    sys.stdout.write('\033[2J\033[H')  # ì „ì²´ í™”ë©´ í´ë¦¬ì–´
    self._first_render = False
# ì´í›„ì—ëŠ” ì»¤ì„œ í¬ì§€ì…”ë‹ë§Œ ì‚¬ìš©
```

**ëª©ì **: ì²« ì‹¤í–‰ ì‹œì—ë§Œ í™”ë©´ í´ë¦¬ì–´, ì´í›„ì—ëŠ” ì œìë¦¬ ì—…ë°ì´íŠ¸

### 5. ì»¤ì„œ ê°€ì‹œì„± ê´€ë¦¬
```python
# __init__ì—ì„œ (ì‹œì‘ ì‹œ)
sys.stdout.write('\033[?25l')  # ì»¤ì„œ ìˆ¨ê¸°ê¸°

# cleanup()ì—ì„œ (ì¢…ë£Œ ì‹œ)
sys.stdout.write('\033[?25h')  # ì»¤ì„œ ë‹¤ì‹œ í‘œì‹œ
```

**ëª©ì **: ê¹œë¹¡ì´ëŠ” ì»¤ì„œ ì œê±°ë¡œ ê¹”ë”í•œ UI

---

## ğŸ“Š ANSI ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤

| ì½”ë“œ | ê¸°ëŠ¥ | ì‚¬ìš©ì²˜ |
|------|------|--------|
| `\033[2J` | ì „ì²´ í™”ë©´ í´ë¦¬ì–´ | ì²« ë Œë”ë§ |
| `\033[H` | ì»¤ì„œë¥¼ (1,1)ë¡œ ì´ë™ | ë§¤ ë Œë”ë§ ì‹œì‘ |
| `\033[2K` | í˜„ì¬ ë¼ì¸ ì§€ìš°ê¸° | ê° ë¼ì¸ ì¶œë ¥ ì „ |
| `\033[?25l` | ì»¤ì„œ ìˆ¨ê¸°ê¸° | ì´ˆê¸°í™” ì‹œ |
| `\033[?25h` | ì»¤ì„œ í‘œì‹œ | ì¢…ë£Œ ì‹œ |

---

## âœ… êµ¬í˜„ íš¨ê³¼

### Before (v6.13 ì´ì „)
```
[í™”ë©´ ë§¨ ìœ„]
... ì´ì „ ì¶œë ¥ë“¤ ...
... ê³„ì† ìŠ¤í¬ë¡¤ ...
... ìƒˆë¡œìš´ ì¶œë ¥ ...
[í™”ë©´ ë§¨ ì•„ë˜ - ê³„ì† ë‚´ë ¤ê° â¬‡ï¸]
```

### After (v6.14-FIXED)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ê³ ì •ëœ í”„ë ˆì„]                â”‚
â”‚                                â”‚
â”‚ [ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì˜ì—­]         â”‚
â”‚ - í¬ì§€ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸         â”‚
â”‚ - AI í•™ìŠµ ë°ì´í„° ì—…ë°ì´íŠ¸      â”‚
â”‚ - ê±°ë˜ í†µê³„ ì—…ë°ì´íŠ¸           â”‚
â”‚                                â”‚
â”‚ [í”„ë ˆì„ì€ ì ˆëŒ€ ì›€ì§ì´ì§€ ì•ŠìŒ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â† í™”ë©´ ê³ ì •! ë‚´ìš©ë§Œ ë³€ê²½! â†’
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
cd /home/user/webapp
python test_fixed_screen.py
```

**í…ŒìŠ¤íŠ¸ ë‚´ìš©**:
- 30ì´ˆ ë™ì•ˆ 3ì´ˆë§ˆë‹¤ í™”ë©´ ì—…ë°ì´íŠ¸
- í¬ì§€ì…˜ ì¶”ê°€/ì œê±° ì‹œë®¬ë ˆì´ì…˜
- AI í•™ìŠµ ë°ì´í„° ì‹¤ì‹œê°„ ë³€ê²½
- ê±°ë˜ í†µê³„ ì¦ê°€
- ì‹œì¥ ì¡°ê±´ ë³€ê²½
- ëª¨ë‹ˆí„°ë§ ë©”ì‹œì§€ ìˆœí™˜

**í™•ì¸ì‚¬í•­**:
- âœ… í™”ë©´ì´ ìŠ¤í¬ë¡¤ë˜ì§€ ì•ŠìŒ
- âœ… ê³ ì •ëœ í”„ë ˆì„ ë‚´ì—ì„œë§Œ ì—…ë°ì´íŠ¸
- âœ… ëª¨ë“  ë°ì´í„°ê°€ ì‹¤ì‹œê°„ ë™ê¸°í™”
- âœ… í”„ë ˆì„ ì™¸ë¶€ì— í…ìŠ¤íŠ¸ ì¶œë ¥ ì—†ìŒ

### ì‹¤ì œ ë´‡ í…ŒìŠ¤íŠ¸
```bash
cd /home/user/webapp
python run.py --mode backtest
```

---

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### ìŠ¤í¬ë¡¤ì´ ì—¬ì „íˆ ë°œìƒí•˜ëŠ” ê²½ìš°

1. **í„°ë¯¸ë„ ë†’ì´ í™•ì¸**
```python
import os
print(os.get_terminal_size())
# í„°ë¯¸ë„ í¬ê¸°ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë‚´ìš©ì´ ì˜ë¦´ ìˆ˜ ìˆìŒ
```

2. **ANSI ì§€ì› í™•ì¸ (Windows)**
```python
import ctypes
kernel32 = ctypes.windll.kernel32
# VIRTUAL_TERMINAL_PROCESSINGì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
```

3. **ì¶œë ¥ ë¼ì¸ ìˆ˜ í™•ì¸**
```python
# render() ë©”ì„œë“œì— ë””ë²„ê·¸ ì¶”ê°€
print(f"[DEBUG] ì¶œë ¥ ë¼ì¸ ìˆ˜: {len(output_lines)}, í™”ë©´ ë†’ì´: {self.screen_height}")
```

### ê¹œë¹¡ì„ ë°œìƒí•˜ëŠ” ê²½ìš°
- `sys.stdout.flush()` í˜¸ì¶œ í™•ì¸
- ë²„í¼ë§ ë¬¸ì œ ê°€ëŠ¥ì„±: `python -u` ì˜µì…˜ ì‚¬ìš©

---

## ğŸ“ ë³€ê²½ ì‚¬í•­ ìš”ì•½

### íŒŒì¼: `/home/user/webapp/src/utils/fixed_screen_display.py`

**__init__ ë©”ì„œë“œ**:
- `screen_height` ê³„ì‚° ì¶”ê°€
- `_first_render` í”Œë˜ê·¸ ì¶”ê°€
- ì»¤ì„œ ìˆ¨ê¸°ê¸° (`\033[?25l`)

**render() ë©”ì„œë“œ** (ì™„ì „ ì¬ì‘ì„±):
- ê³ ì • ë†’ì´ ë²„í¼ ê´€ë¦¬
- ì»¤ì„œ í¬ì§€ì…”ë‹ ì‹œìŠ¤í…œ
- ë¼ì¸ë³„ ë®ì–´ì“°ê¸°
- ìŠ¤í¬ë¡¤ ì™„ì „ ì œê±°

**cleanup() ë©”ì„œë“œ** (ì‹ ê·œ):
- ì»¤ì„œ ë‹¤ì‹œ í‘œì‹œ (`\033[?25h`)
- ì¢…ë£Œ ì‹œ í„°ë¯¸ë„ ìƒíƒœ ë³µì›

### íŒŒì¼: `/home/user/webapp/src/main.py`

**stop() ë©”ì„œë“œ**:
- `display.cleanup()` í˜¸ì¶œ ì¶”ê°€
- ì¢…ë£Œ ì‹œ í™”ë©´ ì •ë¦¬

---

## ğŸ“ í•µì‹¬ ì›ë¦¬

### ê¸°ì¡´ ë°©ì‹ (Append ë°©ì‹)
```python
print(line1)
print(line2)
print(line3)
# ê³„ì† ì¶”ê°€ë˜ë©´ì„œ í™”ë©´ì´ ìŠ¤í¬ë¡¤ë¨
```

### ìƒˆë¡œìš´ ë°©ì‹ (Overwrite ë°©ì‹)
```python
move_cursor_to_home()
clear_line(); write_line1()
clear_line(); write_line2()
clear_line(); write_line3()
# ê°™ì€ ìœ„ì¹˜ì— ê³„ì† ë®ì–´ì“°ë¯€ë¡œ ìŠ¤í¬ë¡¤ ì—†ìŒ
```

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ë¦¬
- ê³ ì • í¬ê¸° ë²„í¼ ì‚¬ìš© (screen_height)
- ë¶ˆí•„ìš”í•œ ë¼ì¸ ìƒì„± ë°©ì§€

### CPU
- ì²« ë Œë”ë§ í›„ í´ë¦¬ì–´ ì•ˆ í•¨
- í•„ìš”í•œ ë¼ì¸ë§Œ ì—…ë°ì´íŠ¸

### ê¹œë¹¡ì„ ë°©ì§€
- í•œ ë²ˆì— ëª¨ë“  ë¼ì¸ ì¤€ë¹„
- flush()ë¡œ ì¼ê´„ ì¶œë ¥

---

## ğŸ“š ì°¸ê³  ìë£Œ

- ANSI ì´ìŠ¤ì¼€ì´í”„ ì‹œí€€ìŠ¤: https://en.wikipedia.org/wiki/ANSI_escape_code
- Windows Console Virtual Terminal: https://docs.microsoft.com/en-us/windows/console/console-virtual-terminal-sequences
- Python curses ëŒ€ì•ˆ: ì»¤ìŠ¤í…€ ANSI êµ¬í˜„

---

## âœ¨ ë²„ì „ íˆìŠ¤í† ë¦¬

- **v6.14-FIXED**: ì™„ì „ ê³ ì • í™”ë©´ êµ¬í˜„ (ìŠ¤í¬ë¡¤ ì œê±°)
- v6.13: ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ (ë™ê¸°í™” ë¬¸ì œ ì§„ë‹¨)
- v6.12: ê°€ê²© ì†Œìˆ˜ì  í‘œì‹œ ê°œì„ 
- v6.11: í¬ì§€ì…˜ ìƒì„¸ ì •ë³´ 4ì¤„ í‘œì‹œ
- v6.10: Windows ANSI ì§€ì› ì¶”ê°€

---

## ğŸ¯ ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ ì¶©ì¡±

### âœ… ìš”êµ¬ì‚¬í•­ 1: ê³ ì •ëœ ë„¤ëª¨ ìƒì
- í„°ë¯¸ë„ í¬ê¸°ì— ë§ì¶° ê³ ì •ëœ í”„ë ˆì„ ìƒì„±
- í”„ë ˆì„ì€ ì ˆëŒ€ ì›€ì§ì´ì§€ ì•ŠìŒ

### âœ… ìš”êµ¬ì‚¬í•­ 2: ìƒì ì•ˆì—ì„œë§Œ ê¸€ì ì—…ë°ì´íŠ¸
- ì»¤ì„œ í¬ì§€ì…”ë‹ìœ¼ë¡œ ì œìë¦¬ ì—…ë°ì´íŠ¸
- í”„ë ˆì„ ì™¸ë¶€ë¡œ í…ìŠ¤íŠ¸ ì¶œë ¥ ì—†ìŒ

### âœ… ìš”êµ¬ì‚¬í•­ 3: ìŠ¤í¬ë¡¤ ì—†ìŒ
- ë†’ì´ ì œí•œ ì—„ê²© ì ìš©
- í„°ë¯¸ë„ ê²½ê³„ ì ˆëŒ€ ì´ˆê³¼ ì•ˆ í•¨

### âœ… ìš”êµ¬ì‚¬í•­ 4: ì‹¤ì‹œê°„ ë™ê¸°í™”
- 3ì´ˆë§ˆë‹¤ ëª¨ë“  ë°ì´í„° ì—…ë°ì´íŠ¸
- ê°€ê²©, ì†ìµ, AI í•™ìŠµ, ê±°ë˜ í†µê³„ ë™ê¸°í™”

---

## ğŸ‰ ê²°ê³¼

**ì™„ë²½í•œ ê³ ì • í™”ë©´ ë””ìŠ¤í”Œë ˆì´ êµ¬í˜„ ì™„ë£Œ!**

ì‚¬ìš©ìê°€ ìš”ì²­í•œ ëŒ€ë¡œ:
- ğŸ“¦ **ë„¤ëª¨ ìƒìê°€ í™”ë©´ì— ê³ ì •ë¨**
- ğŸ”„ **ìƒì ì•ˆì˜ í…ìŠ¤íŠ¸ë§Œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¨**
- ğŸš« **ìŠ¤í¬ë¡¤ì´ ì™„ì „íˆ ì œê±°ë¨**
- âš¡ **ëª¨ë“  ë°ì´í„°ê°€ 3ì´ˆë§ˆë‹¤ ë™ê¸°í™”ë¨**
